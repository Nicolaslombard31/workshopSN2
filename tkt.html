<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quadrillage cliquable — 24x18</title>
<style>
    html {
        background-color: #222;
    }
  body {
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    padding: 18px; background: #222#f6f7fb; color: #222;
    display: flex;
    flex-direction: column;
    align-items: center;  
    justify-content: flex-start; 
    min-height: 100vh;
  }
  h1 { font-size: 18px; margin: 0 0 10px; }
  canvas {
    background: white; border: 1px solid #ddd;
    box-shadow: 0 6px 20px rgba(20,30,60,0.06);
    cursor: crosshair; display: block;
    max-width: 100%; height: auto;
    margin: 0 auto; 
  }
  .btn {
    padding: 6px 10px; border-radius: 6px;
    background: rgb(202, 4, 4); color: white; border: 0; cursor: pointer;
    margin: 10px auto;  
    display: block;
  }
</style>
</head>
<body>

<button class="btn" id="clearBtn">Vider (tout ouvert)</button>
<canvas id="canvas"></canvas>
<button class="btn" id="retourIndex">Retourner sur la page de recherche</button>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const cols = 24;
const rows = 18;

const imgOpen = new Image();
const imgClosed = new Image();
imgOpen.src = 'maison.jpg';
imgClosed.src = 'maisonfermé.png';

let cells = Array.from({length: rows}, () => Array(cols).fill(false));

let isMouseDown = false;
let lastToggled = null;

function resizeCanvasToImage(w, h) {
  canvas.width = w; canvas.height = h;
  canvas.style.width = Math.min(w, 900) + 'px';
  canvas.style.height = (canvas.style.width.replace('px','') * (h / w)) + 'px';
}

function draw() {
  if (!imgOpen.complete || !imgClosed.complete) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.drawImage(imgOpen, 0, 0, canvas.width, canvas.height);

  const cellW = canvas.width / cols;
  const cellH = canvas.height / rows;

  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      if (cells[r][c]) {
        const x = c * cellW, y = r * cellH, w = cellW, h = cellH;
        ctx.save();
        ctx.beginPath();
        ctx.rect(x, y, w, h);
        ctx.clip();
        ctx.drawImage(imgClosed, 0, 0, canvas.width, canvas.height);
        ctx.restore();
      }
    }
  }

  // grille
  ctx.save();
  ctx.strokeStyle = 'rgba(0,0,0,0.12)';
  ctx.lineWidth = 1;
  for (let i = 1; i < cols; i++) {
    const x = i * cellW + 0.5;
    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
  }
  for (let j = 1; j < rows; j++) {
    const y = j * cellH + 0.5;
    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
  }
  ctx.restore();
}

function getCanvasPos(evt) {
  const rect = canvas.getBoundingClientRect();
  const x = (evt.clientX - rect.left) * (canvas.width / rect.width);
  const y = (evt.clientY - rect.top) * (canvas.height / rect.height);
  return {x,y};
}

function toggleCellAt(x, y) {
  const cellW = canvas.width / cols;
  const cellH = canvas.height / rows;
  const c = Math.floor(x / cellW);
  const r = Math.floor(y / cellH);
  if (r<0 || r>=rows || c<0 || c>=cols) return;
  const key = r+','+c;
  if (lastToggled === key) return;
  lastToggled = key;
  cells[r][c] = !cells[r][c];
  draw();
}

canvas.addEventListener('mousedown', e=>{
  isMouseDown = true; lastToggled=null;
  const pos = getCanvasPos(e);
  toggleCellAt(pos.x,pos.y);
});
canvas.addEventListener('mouseup', ()=>{isMouseDown=false; lastToggled=null;});
canvas.addEventListener('mouseleave', ()=>{isMouseDown=false; lastToggled=null;});
canvas.addEventListener('mousemove', e=>{
  if (!isMouseDown) return;
  const pos = getCanvasPos(e);
  toggleCellAt(pos.x,pos.y);
});

// bouton vider
document.getElementById('clearBtn').addEventListener('click', ()=>{
  cells = Array.from({length: rows}, () => Array(cols).fill(false));
  draw();
});

document.getElementById('retourIndex').addEventListener('click', ()=>{
  window.location.href = 'index.html';
});

function onBothLoaded() {
  if (!imgOpen.complete || !imgClosed.complete) return;
  resizeCanvasToImage(imgOpen.naturalWidth, imgOpen.naturalHeight);
  draw();
}
imgOpen.onload = onBothLoaded;
imgClosed.onload = onBothLoaded;
</script>
</body>
</html>
